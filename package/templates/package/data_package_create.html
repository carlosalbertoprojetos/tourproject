
{% extends 'dashboard.html' %}
{% load i18n account static crispy_forms_tags %}
{% block title %}
    Pacote
{% endblock title %}
{% block dashboard %}

<style>
    .hidden {
        display: none
    }
</style>

<div class="header">
    <div class="container mt-2">
        <div class="card">
            <div class='row'>
                <h3 class="form-title mb-3 p-3">Pacote Turístico para {{destiny}}</h3>
            </div>
            <div class='row'>
                <form action='.' method='POST' class='form-group p-2'>
                    {% csrf_token %}
                    <div class='row'>
                        <div class='col-6'>
                        {{ form|crispy }}
                        </div>
                    </div>
                    {% if formset %}
                    <div class='row'>
                        <div style="display: None;" class="alert alert-danger" role="alert" id="id_message">
                            Por favor, informe as idades das crianças
                        </div>
                        {{ formset.management_form }}
                        <div id='children_age_list'> 
                            {% for form in formset %}
                            <div class='child_age_form form-horizontal'>
                                {{ form|crispy }}
                            </div>
                            {% endfor %}
                        </div>
                        <div id='empty-form' class='hidden'>{{ formset.empty_form|crispy}}</div>
                        {% endif %}
                        <div class='row'>
                            <div class='col-2'>
                                <button type='submit' class='btn btn-primary w-100'>Save</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>  
    </div>

<script>

    function campos() {
        $("#id_num_child").keyup(() => {
            let quantidade = $("#id_num_child").val();
            message = document.getElementById('id_message')
            message.setAttribute('style', 'display:flex;')

            const totalNewForms = document.getElementById('id_child_package_one_set-TOTAL_FORMS')

            if (quantidade) {
                quantidade = parseInt(quantidade);

                for (let i=0; i < quantidade; i++) {
                    const currentChildAgeForms = document.getElementsByClassName('child_age_form')
                    const currentFormCount = currentChildAgeForms.length
                    const formCopyTarget = document.getElementById('children_age_list')
                    
                    const copyEmptyFormEl = document.getElementById('empty-form').cloneNode(true)
                    copyEmptyFormEl.setAttribute('class', 'child_age_form')
                    copyEmptyFormEl.setAttribute('id', `id_child_package_one_set-${currentFormCount}-children_age`)
                    const regex =  new RegExp('__prefix__', 'g')
                    copyEmptyFormEl.innerHTML = copyEmptyFormEl.innerHTML.replace(regex, currentFormCount)
                    totalNewForms.setAttribute('value', currentFormCount + 1)
                    formCopyTarget.append(copyEmptyFormEl)
                }
            }
        })
    }

</script>

{% endblock %}
